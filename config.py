import os
from dotenv import load_dotenv

load_dotenv()

BOT_TOKEN = os.getenv('BOT_TOKEN')
if not BOT_TOKEN:
    raise ValueError("Не установлен BOT_TOKEN в переменных окружения")

# Настройки игры
MIN_PLAYERS = 1  # Минимум для тестирования (можно начать с 1 игрока)
MAX_PLAYERS = 20

# Автоведение игры: тайминги фаз (в секундах)
# Ночь длится до выполнения всех действий или до NIGHT_TIMEOUT_SECS
NIGHT_TIMEOUT_SECS = 90
# Обсуждение днем
DAY_DISCUSS_TIMEOUT_SECS = 90
# Голосование длится до голосов всех живых или до VOTING_TIMEOUT_SECS
VOTING_TIMEOUT_SECS = 60

# Настройки работы бота
# Можно переопределить через переменную окружения BOT_WORK_TIMEOUT_HOURS.
# Установите 0 или отрицательное значение, чтобы отключить таймаут (например, на Render).
try:
    BOT_WORK_TIMEOUT_HOURS = float(os.getenv('BOT_WORK_TIMEOUT_HOURS', '6'))
except ValueError:
    BOT_WORK_TIMEOUT_HOURS = 6.0

# Настройки рассылки по умолчанию (если нет активных игр)
# Укажите ID чата (супергруппы/форума) и ID темы, куда слать рассылку
# Пример в .env:
# BROADCAST_CHAT_ID=-1001234567890
# BROADCAST_THREAD_ID=39431
def _parse_int(value: str, default: int = 0) -> int:
    try:
        return int(value)
    except Exception:
        return default

BROADCAST_CHAT_ID = _parse_int(os.getenv('BROADCAST_CHAT_ID', '0'), 0)
BROADCAST_THREAD_ID = _parse_int(os.getenv('BROADCAST_THREAD_ID', '0'), 0)

# Роли и их количество (в зависимости от количества игроков)
ROLE_DISTRIBUTION = {
    4:  {"мафия": 1, "мирный": 2, "доктор": 1},
    5:  {"мафия": 1, "мирный": 2, "доктор": 1, "комиссар": 1},
    6:  {"мафия": 1, "мирный": 3, "доктор": 1, "комиссар": 1},
    7:  {"мафия": 2, "мирный": 3, "доктор": 1, "комиссар": 1},
    8:  {"мафия": 2, "мирный": 3, "доктор": 1, "комиссар": 1, "ночная_бабочка": 1},
    9:  {"мафия": 2, "мирный": 4, "доктор": 1, "комиссар": 1, "ночная_бабочка": 1},
    10: {"мафия": 2, "мирный": 5, "доктор": 1, "комиссар": 1, "ночная_бабочка": 1},
    11: {"мафия": 2, "мирный": 6, "доктор": 1, "комиссар": 1, "ночная_бабочка": 1},
    12: {"мафия": 3, "мирный": 6, "доктор": 1, "комиссар": 1, "ночная_бабочка": 1},
    13: {"мафия": 3, "мирный": 7, "доктор": 1, "комиссар": 1, "ночная_бабочка": 1},
    14: {"мафия": 4, "мирный": 7, "доктор": 1, "комиссар": 1, "ночная_бабочка": 1},
    15: {"мафия": 4, "мирный": 7, "доктор": 2, "комиссар": 1, "ночная_бабочка": 1},
    16: {"мафия": 4, "мирный": 8, "доктор": 2, "комиссар": 1, "ночная_бабочка": 1},
    17: {"мафия": 5, "мирный": 8, "доктор": 2, "комиссар": 1, "ночная_бабочка": 1},
    18: {"мафия": 5, "мирный": 8, "доктор": 2, "комиссар": 2, "ночная_бабочка": 1},
    19: {"мафия": 5, "мирный": 9, "доктор": 2, "комиссар": 2, "ночная_бабочка": 1},
    20: {"мафия": 6, "мирный": 9, "доктор": 2, "комиссар": 2, "ночная_бабочка": 1},
}


